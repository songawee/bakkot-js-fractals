<html> <head>  <script type="application/x-javascript">var scale = 250;var vda;var invert = 1;function draw() {  canvas = document.getElementById("canvas");  ctx = canvas.getContext("2d");  ctx.fillStyle = "rgb(0,0,0)";  canvas.height = scale*2+2  canvas.width = scale*2+2  ctx.translate(scale+1, scale+1)  //invoke start function here  getStarted()}function drawLine(startCoords, endCoords) {  startCoords = [startCoords[0]*scale,startCoords[1]*scale*(-1)]  endCoords = [endCoords[0]*scale,endCoords[1]*scale*(-1)]  ctx.beginPath();  ctx.moveTo(startCoords[0], startCoords[1]);  ctx.lineTo(endCoords[0], endCoords[1]);  ctx.stroke()}function drawPoints() {  for(i=0; i<arguments.length; i++) {    drawLine(arguments[i],[arguments[i][0]+1/scale,arguments[i][1] + 1/scale]);  }}function drawRect(startCoords, endCoords, filled) {  startCoords = [startCoords.split(",")[0]*scale,startCoords.split(",")[1]*scale*(-1)+scale]  endCoords = [endCoords.split(",")[0]*scale,endCoords.split(",")[1]*scale*(-1)+scale]  if(filled)    ctx.fillRect(startCoords[0],startCoords[1],endCoords[0]-startCoords[0],endCoords[1]-startCoords[1]);  else    ctx.strokeRect(startCoords[0],startCoords[1],endCoords[0]-startCoords[0],endCoords[1]-startCoords[1]);}function getStarted() {  //vda = [[[-.5,.5],[.5,.5],[0,0]]]  //"vda" = Very Dangerous Array  vda = [[[-.5,.5],[.5,.5],[0,0]],[[.5,.5],[.5,-.5],[0,0]],[[.5,-.5],[-.5,-.5],[0,0]],[[-.5,-.5],[-.5,.5],[0,0]]]  //"vda" = Very Dangerous Array  vda.forEach(drawIterate)}function sq(v) {  return v*v;}function calcDist(p1, p2) {  return Math.sqrt(sq(p1[0]-p2[0]) + sq(p1[1]-p2[1]))}function newPoints(ar) {  var p1 = ar[0];  var p2 = ar[1];  var c = ar[2];  var o;  if(p1[0] == p2[0]) o = -1;  else if(p1[1] == p2[1]) o = 1;  else alert("Brok")     if(o==1) {    dist = Math.abs(p1[0]-p2[0])/3    l = Math.min(p1[0], p2[0])    m = Math.max(p1[0], p2[0])    n1 = [l+dist, p1[1]+dist]    n2 = [l+dist, p1[1]-dist]        n21 = [m-dist, p1[1]+dist]    n22 = [m-dist, p1[1]-dist]    n3 = [l+dist, p1[1]]    n4 = [m-dist, p1[1]]      }  else {    dist = Math.abs(p1[1]-p2[1])/3    l = Math.min(p1[1], p2[1])    m = Math.max(p1[1], p2[1])    n1 = [p1[0]+dist, l+dist]    n2 = [p1[0]-dist, l+dist]        n21 = [p1[0]+dist, m-dist]    n22 = [p1[0]-dist, m-dist]    n3 = [p1[0],l+dist]    n4 = [p1[0], m-dist]  }    if((calcDist(n1, c) > calcDist(n2, c)) ^ invert) {    return [n3, n1, n21, n4]  }  else if(calcDist(n1, c) < calcDist(n2, c) ^ invert) {    return [n3, n2, n22, n4]  }  else {    alert("Bork!")     alert(n1 + "  " + n2)  }}function convert(ar) {  nps = newPoints(ar)  cent = calcCent(nps)  if(calcDist(ar[0], nps[0]) < calcDist(ar[0], nps[3]))    nar = [  [ar[0], nps[0], ar[2]],   [nps[0], nps[1], cent],   [nps[1], nps[2], cent],   [nps[2], nps[3], cent],   [nps[3], ar[1], ar[2]]]  else    nar = [  [ar[0], nps[3], ar[2]],   [nps[3], nps[2], cent],   [nps[2], nps[1], cent],   [nps[1], nps[0], cent],   [nps[0], ar[1], ar[2]]]  return nar;}function iterate(v, i, a) {  if(typeof(v[0][0]) == "object") {    a[i].forEach(iterate)  }  else {    a[i] = convert(a[i])  }}function drawIterate(v, i, a) {  if(typeof(v[0][0]) == "object") {    v.forEach(drawIterate)  }  else {    drawLine(v[0], v[1])  }}function calcCent(sqr) {  x = (sqr[0][0] + sqr[1][0] + sqr[2][0] + sqr[3][0])/4  y = (sqr[0][1] + sqr[1][1] + sqr[2][1] + sqr[3][1])/4  return [x,y]}function redraw() {  ctx.clearRect(-scale,-scale,canvas.width,canvas.height);  scale = document.getElementById("scalebox").value*1;  canvas.height = scale*2+2  canvas.width = scale*2+2  ctx.translate(scale+1, scale+1)  vda.forEach(drawIterate);}function resetScale() {  ctx.clearRect(-scale,-scale,canvas.width,canvas.height);  scale = 250;  document.getElementById("scalebox").value = 250;  document.getElementById("invbox").checked=false;  draw();}function oneMore() {  invert = document.getElementById("invbox").checked;  ctx.clearRect(-scale,-scale,canvas.width,canvas.height);  vda.forEach(iterate);  vda.forEach(drawIterate);} </script> </head> <body onload="draw()">   <form>   Scale: <input type="text" id="scalebox" value=250 size=4>&nbsp&nbsp   <input type="button" value="Apply" onclick="redraw()">&nbsp&nbsp&nbsp   <input type="button" value="Reset" onclick="resetScale()">&nbsp&nbsp&nbsp   <input type="button" value="Iterate" onclick="oneMore()">&nbsp&nbsp&nbsp   Invert next iteration: <input type="checkbox"  id="invbox"><br><br>   <canvas id="canvas" width="1" height="1"></canvas> </body></html>